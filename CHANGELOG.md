# سجل التغييرات - Gaza Exchange App

جميع التغييرات المهمة في هذا المشروع سيتم توثيقها في هذا الملف.

## [3.2.6] - 2025-06-29

### 🔐 حل مشكلة التخزين الآمن للصور
- ✅ **API Endpoint للصور**: إضافة `getImageBytes()` و `getImageApiUrl()` في ApiService
- ✅ **تحديث النماذج**: استخدام API endpoints بدلاً من الروابط المباشرة
- ✅ **أمان محسن**: حماية من directory traversal والوصول غير المصرح
- ✅ **مرونة في التخزين**: دعم multiple storage locations (public/private)
- ✅ **معالجة أخطاء**: placeholders مناسبة لكل نوع خطأ

### 📚 توثيق شامل
- ✅ **إنشاء SECURE_IMAGE_HANDLING.md**: دليل شامل للحلول الآمنة
- ✅ **3 حلول مختلفة**: API endpoint, Controller مخصص, Public storage
- ✅ **كود Laravel جاهز**: أمثلة كاملة للتطبيق على السيرفر
- ✅ **مقارنة الحلول**: جدول تقييم الأمان والأداء

### 🔧 تحسينات تقنية
- ✅ **URLs آمنة**: `http://localhost:8000/api/image?path=...`
- ✅ **Token authentication**: دعم Bearer tokens للأمان
- ✅ **Caching headers**: تحسين الأداء مع cache control
- ✅ **MIME type validation**: التحقق من نوع الملفات

---

## [3.2.4] - 2025-01-20

### 🎨 UI/UX Improvements
- **تحسين CustomCard Widget**: 
  - معالجة أخطاء متقدمة للصور مع تمييز خاص لأخطاء السيرفر (403 Forbidden)
  - placeholders محسنة للصور غير المتاحة والأخطاء
  - دعم CachedNetworkImage لتحسين الأداء
  - رسائل خطأ واضحة ومفيدة للمستخدم
- **تحديث واجهات القوائم**: 
  - استخدام CustomCard المحسن في قوائم السلع والعقارات
  - تبسيط الكود وتحسين القابلية للصيانة
  - عرض أفضل للمعلومات مع emojis وتنسيق محسن

### 🏠 Property Model Fixes
- **دعم تنسيقات API متعددة**: 
  - معالجة تنسيقين مختلفين للصور من API (مصفوفة نصوص ومصفوفة كائنات)
  - دعم تلقائي للتنسيق القديم والجديد
- **إضافة الحقول المفقودة**: 
  - إضافة bedrooms, bathrooms, area, status حسب التوثيق
  - قيم افتراضية آمنة للحقول المفقودة
- **تحسين مسارات الصور**: 
  - مسارات صحيحة للصور في مجلد properties
  - معالجة أفضل للـ URLs المطلقة والنسبية

### 🔧 Code Quality
- **تنظيف الكود**: إزالة الكود المكرر في واجهات العرض
- **تحسين الأداء**: استخدام widget واحد بدلاً من عدة widgets مخصصة
- **معالجة أخطاء شاملة**: تسجيل أفضل للأخطاء مع معلومات تشخيصية
- **توافق API كامل**: دعم جميع endpoints العقارات

### 📚 Documentation
- **تحديث SERVER_STORAGE_FIX.md**: إضافة حلول شاملة وخطوات استكشاف الأخطاء
- **إنشاء PROPERTY_MODEL_FIX.md**: دليل شامل لإصلاحات نموذج العقارات
- **إنشاء ENHANCED_IMAGE_HANDLING.md**: توثيق تحسينات معالجة الصور
- **تحسين التوثيق**: إضافة جدول الأخطاء الشائعة وحلولها

---

## [3.2.3] - 2025-01-20

### 🔧 Improved
- **تحسين معالجة أخطاء الصور**: 
  - إضافة رسائل خطأ أكثر وضوحاً عند فشل تحميل الصور
  - تحسين placeholder للصور غير المتاحة
  - إضافة تفاصيل أكثر في logs لتشخيص مشاكل الصور
- **تشخيص مشكلة خطأ 403**: 
  - تحديد أن المشكلة في صلاحيات السيرفر وليس في التطبيق
  - إضافة رسائل واضحة للمطور لفهم سبب المشكلة

### 📚 Documentation
- **إنشاء SERVER_STORAGE_FIX.md**: دليل شامل لإصلاح مشكلة الوصول للصور على السيرفر
- **حلول مشكلة خطأ 403**: خطوات تفصيلية لإصلاح صلاحيات مجلد storage

### 🐛 Server Issue Identified
- **مشكلة خطأ 403**: تم تحديد أن المشكلة في إعداد السيرفر Laravel وليس في التطبيق
- **الحل المطلوب**: تشغيل `php artisan storage:link` على السيرفر

---

## [3.2.2] - 2025-01-20

### 🐛 Fixed
- **إصلاح مشكلة عرض الصور**: 
  - تحديث جميع الواجهات لتستخدم `firstImageUrl` بدلاً من `fullImageUrl`
  - إصلاح عرض الصور في قوائم السلع والعقارات
  - إصلاح عرض الصور في صفحات تفاصيل السلع والعقارات
  - دعم التوافق مع النظام القديم والجديد للصور
- **تحسين نظام الصور المتعددة**: 
  - عرض الصورة الأولى من المصفوفة الجديدة
  - fallback للصور القديمة في حالة عدم وجود صور جديدة
  - تحسين أداء تحميل الصور

### 📚 Documentation
- **إنشاء IMAGE_DISPLAY_FIX.md**: دليل شامل لإصلاح مشكلة عرض الصور
- **توثيق نظام الصور المتعددة**: شرح كيفية عمل النظام الجديد والقديم

---

## [3.2.1] - 2025-01-20

### 🐛 Fixed
- **إصلاح خطأ API العقارات (422 و 500)**: 
  - إرسال كلا الحقلين `location` و `address` بنفس القيمة (حل تضارب السيرفر)
  - تحديث نوع العقار لدعم `buy` و `rent` فقط (تحويل `تبادل` إلى `buy`)
  - إضافة الحقول المطلوبة: `bedrooms`, `bathrooms`, `area`
  - حل تضارب بين API validation (يتوقع location) وقاعدة البيانات (تتوقع address)
- **تحسين معالجة أخطاء 422 و 500**: رسائل خطأ أكثر وضوحاً
- **تحديث Validators**: إصلاح دالة `convertPropertyTypeToEnglish`

### 📚 Documentation
- **تحديث PROPERTY_API_FIX.md**: دليل شامل لإصلاح مشكلة API العقارات مع تفاصيل الأخطاء 422 و 500
- **تحديث التوثيق**: توضيح التضارب بين validation API وقاعدة البيانات

---

## [3.2.0] - 2025-01-20

### ✨ Added
- **دعم التصنيفات الفرعية**: إمكانية اختيار تصنيف رئيسي ثم تصنيف فرعي عند إضافة سلعة
- **الصور المتعددة**: دعم إضافة حتى 5 صور لكل سلعة بدلاً من صورة واحدة
- **تحسينات في واجهة المستخدم**: عرض أفضل للصور مع أرقام وعداد
- **تحميل تلقائي للتصنيفات الفرعية**: عند اختيار التصنيف الرئيسي

### 🔧 Changed
- **تحديث AddItemController**: دعم التصنيفات الفرعية والصور المتعددة
- **تحديث CategoryController**: إضافة دالة `loadSubcategories()` للاتصال بـ API
- **تحديث add_item_view.dart**: واجهة محسنة للتصنيفات والصور
- **تحديث API integration**: إرسال الصور كـ `images[]` بدلاً من `image`

### 🐛 Fixed
- **معالجة أخطاء التصنيفات**: تحسين رسائل الخطأ للتصنيفات غير الموجودة
- **معالجة أخطاء الصور**: تحسين معالجة أخطاء رفع الملفات
- **تحسين الأداء**: تحميل التصنيفات الفرعية عند الحاجة فقط

### 📚 Documentation
- **تحديث CATEGORIES_MIGRATION.md**: توثيق التحديثات الجديدة
- **تحديث API documentation**: إضافة endpoints للتصنيفات الفرعية

---

## [3.1.0] - 2025-01-19

### ✨ Added
- **نظام التصنيفات الديناميكي**: استخدام API بدلاً من الثوابت المحلية
- **CategoryController**: إدارة مركزية للتصنيفات
- **دعم التصنيفات الفرعية**: هيكل بيانات محسن للتصنيفات
- **معالجة التكرار**: فلترة التصنيفات المكررة والفارغة

### 🔧 Changed
- **إزالة الثوابت المحلية**: إزالة `mainCategories` من constants.dart
- **تحديث جميع Controllers**: استخدام CategoryController بدلاً من الثوابت
- **تحسين واجهة المستخدم**: مؤشرات تحميل وحالات خطأ محسنة

### 🐛 Fixed
- **أخطاء DropdownButton**: حل مشكلة القيم المكررة في التصنيفات
- **معالجة البيانات الفارغة**: فلترة التصنيفات غير الصحيحة
- **تحسين الأداء**: تحميل التصنيفات مرة واحدة عند بدء التطبيق

### 📚 Documentation
- **إنشاء CATEGORIES_MIGRATION.md**: دليل شامل للتحديث
- **تحديث API documentation**: توثيق endpoints الجديدة

---

## [3.0.0] - 2025-01-18

### ✨ Added
- **نظام التحقق والتحويل**: تحويل الأرقام العربية إلى الإنجليزية
- **Validators utility**: دوال مساعدة للتحويل والتحقق
- **دعم الحالات العربية**: تحويل حالات السلع والعقارات
- **معالجة شاملة للأخطاء**: رسائل خطأ واضحة ومفيدة

### 🔧 Changed
- **تحديث AddItemController**: استخدام Validators للتحويل
- **تحديث AddPropertyController**: استخدام Validators للتحويل
- **تحسين معالجة الأخطاء**: رسائل خطأ أكثر وضوحاً

### 🐛 Fixed
- **خطأ 422 Validation**: حل مشكلة القيم العربية في API
- **تحسين تجربة المستخدم**: رسائل خطأ أفضل

### 📚 Documentation
- **إنشاء Validators utility**: دوال مساعدة شاملة
- **تحديث API documentation**: توثيق القيم المتوقعة

---

## [2.0.0] - 2025-01-17

### 🔄 تحديثات API الرئيسية
- **تحديث شامل لـ API Service**: تحسين جميع نقاط النهاية لتتوافق مع الوثائق الجديدة
- **إصلاح المراجع الدائرية**: إزالة المراجع الدائرية في النماذج لتحسين الأداء
- **تحسين معالجة الأخطاء**: إضافة معالجة أخطاء شاملة ومحسنة
- **تحديث مسارات API**: إزالة الشرطة المائلة الزائدة من بداية المسارات

### 📱 تحديثات النماذج (Models)
- **UserModel**: إضافة دعم للسلع والعقارات في الملف الشخصي
- **ItemModel**: تحسين النموذج وإزالة المراجع الدائرية
- **PropertyModel**: تحديث النموذج ليتوافق مع API الجديد
- **CategoryModel**: إضافة دعم للتصنيفات الفرعية والألوان
- **StatisticsModel**: تحسين نموذج الإحصائيات
- **RecentActivityModel**: إضافة دعم للنشاط الأخير
- **NearbyItemModel**: تحسين نموذج السلع القريبة

### 🔧 تحديثات الخدمات (Services)
- **ApiService**: 
  - إصلاح دالة `uploadFile` للتعامل مع الملفات الاختيارية
  - تحسين معالجة الأخطاء
  - إضافة دعم أفضل للـ FormData
- **UserService**: تحديث جميع الدوال لتتوافق مع API الجديد
- **CategoryService**: تحسين إدارة التصنيفات
- **ItemsService**: تحديث إدارة السلع مع دعم أفضل للصور
- **PropertiesService**: تحسين إدارة العقارات

### 🛠️ أدوات مساعدة جديدة
- **Constants**: إضافة ثوابت جديدة للتطبيق
- **Validators**: إضافة مصادقات شاملة للبيانات
- **LocationHelper**: تحسين خدمات الموقع مع دعم Geolocator

### 📦 تحديثات التبعيات
- **geolocator**: ^10.1.0 - للحصول على الموقع
- **geocoding**: ^2.1.1 - لتحويل الإحداثيات
- **dio**: ^5.4.0 - لطلبات HTTP
- **get**: ^4.6.6 - لإدارة الحالة

### 🎨 تحسينات الواجهة
- تحسين تجربة المستخدم
- إضافة رسائل خطأ أكثر وضوحاً
- تحسين عرض البيانات

### 🔒 تحسينات الأمان
- تحسين إدارة الجلسات
- تشفير أفضل للبيانات الحساسة
- تحسين آليات المصادقة

### 📚 تحديثات الوثائق
- **README.md**: تحديث شامل للوثائق
- **api_documentation.md**: وثائق API محدثة
- **CHANGELOG.md**: سجل التغييرات الجديد

## [1.0.0] - 2024-12-01

### ✨ الميزات الأساسية
- **نظام المصادقة**: تسجيل الدخول والخروج
- **إدارة السلع**: إضافة وتعديل وحذف السلع
- **إدارة العقارات**: إضافة وتعديل وحذف العقارات
- **البحث والفلترة**: البحث في السلع والعقارات
- **الملف الشخصي**: عرض وتعديل معلومات المستخدم

### 🏗️ البنية الأساسية
- **GetX**: إدارة الحالة والتنقل
- **Dio**: طلبات HTTP
- **Shared Preferences**: التخزين المحلي
- **Flutter Secure Storage**: التخزين الآمن

### 📱 الواجهة
- **Material Design**: تصميم الواجهة
- **دعم اللغة العربية**: واجهة باللغة العربية
- **Responsive Design**: تصميم متجاوب

---

## ملاحظات التحديث

### من v1.0.0 إلى v2.0.0
- **تحديث شامل**: يتطلب إعادة تثبيت التطبيق
- **تغييرات API**: تحديث جميع نقاط النهاية
- **تحسينات الأداء**: تحسين كبير في السرعة والاستقرار

### إرشادات التحديث
1. قم بحفظ البيانات المهمة
2. احذف التطبيق القديم
3. قم بتثبيت الإصدار الجديد
4. أعد تسجيل الدخول

---

**تم تطوير هذا التطبيق بواسطة فريق Gaza Exchange** 